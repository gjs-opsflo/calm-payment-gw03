{
  "nodes": [
    {
      "unique-id": "customer",
      "node-type": "actor",
      "name": "Customer",
      "description": "End user making a payment transaction through the checkout process"
    },
    {
      "unique-id": "checkout-page",
      "node-type": "webclient",
      "name": "Checkout Page",
      "description": "PCI-DSS compliant payment form for secure card data entry",
      "controls": {
        "input-validation": {
          "description": "Client-side validation of card number format and CVV",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "secure-transmission": {
          "description": "All payment data transmitted over TLS 1.2 or higher",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "secure-configuration-management": {
          "description": "Addresses PCI-DSS 4.0 Req 2.X (Apply Secure Configurations to All System Components) and NIST CSF 2.0 PR.PS-01 (Configuration management practices established). Critical for reducing attack surface and maintaining system integrity."
        },
        "web-application-firewall": {
          "description": "Addresses PCI-DSS 4.0 Req 6.4.2 (Public-facing web applications protected against attacks). Crucial for protecting against web-based attacks."
        }
      },
      "data-classification": "RESTRICTED"
    },
    {
      "unique-id": "payment-api",
      "node-type": "service",
      "name": "Payment API",
      "description": "Payment processing endpoint orchestrating tokenization, fraud detection, and authorization",
      "controls": {
        "pci-dss-compliance": {
          "description": "PCI-DSS SAQ-D compliant service with annual assessment",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "api-authentication": {
          "description": "API key authentication with rate limiting and IP whitelisting",
          "requirements": [
            {
              "requirement-url": "https://owasp.org/www-project-api-security/"
            }
          ]
        },
        "multi-factor-authentication": {
          "description": "Addresses PCI-DSS 4.0 Req 8.4.2 (MFA for all access into CDE), NIST CSF 2.0 PR.AA-03 (users, services, hardware authenticated), and SOC2 TSC CC6.5 (Logical access restricted using multi-factor authentication). Critically missing MFA for administrative access fails these controls."
        },
        "role-based-access-control": {
          "description": "Addresses PCI-DSS 4.0 Req 7.2 (Access to system components restricted per least privilege), NIST CSF 2.0 PR.AA-05 (Access permissions, entitlements, authorizations managed), and SOC2 TSC CC6.1 (Logical access security software, infrastructure, architectures) and CC6.3 (Role-based access and least privilege). Lack of granular access control fails these requirements."
        },
        "privileged-access-management": {
          "description": "Addresses SOX 404 ITGC Access Controls (Privileged Access Management) for critical financial systems. Enhances security by controlling and auditing elevated access."
        },
        "secure-configuration-management": {
          "description": "Addresses PCI-DSS 4.0 Req 2.X (Apply Secure Configurations to All System Components) and NIST CSF 2.0 PR.PS-01 (Configuration management practices established). Critical for reducing attack surface and maintaining system integrity."
        },
        "web-application-firewall": {
          "description": "Addresses PCI-DSS 4.0 Req 6.4.2 (Public-facing web applications protected against attacks). Crucial for protecting against web-based attacks."
        },
        "secrets-management-service": {
          "description": "Addresses CCC-CIS-06 (Secrets management) and NIST CSF 2.0 PR.AA-01 (Identities and credentials managed). Strengthens the protection of sensitive credentials beyond basic authentication."
        }
      }
    },
    {
      "unique-id": "tokenization-service",
      "node-type": "service",
      "name": "Tokenization Service",
      "description": "PCI-DSS card tokenization service replacing sensitive card data with tokens",
      "controls": {
        "encryption-at-rest": {
          "description": "AES-256 encryption for stored card data in secure vault",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "key-management": {
          "description": "HSM-based key management with key rotation every 90 days",
          "requirements": [
            {
              "requirement-url": "https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final"
            }
          ]
        },
        "access-logging": {
          "description": "Comprehensive audit logging of all vault access with tamper detection",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "multi-factor-authentication": {
          "description": "Addresses PCI-DSS 4.0 Req 8.4.2 (MFA for all access into CDE), NIST CSF 2.0 PR.AA-03 (users, services, hardware authenticated), and SOC2 TSC CC6.5 (Logical access restricted using multi-factor authentication). Critically missing MFA for administrative access fails these controls."
        },
        "role-based-access-control": {
          "description": "Addresses PCI-DSS 4.0 Req 7.2 (Access to system components restricted per least privilege), NIST CSF 2.0 PR.AA-05 (Access permissions, entitlements, authorizations managed), and SOC2 TSC CC6.1 (Logical access security software, infrastructure, architectures) and CC6.3 (Role-based access and least privilege). Lack of granular access control fails these requirements."
        },
        "privileged-access-management": {
          "description": "Addresses SOX 404 ITGC Access Controls (Privileged Access Management) for critical financial systems. Enhances security by controlling and auditing elevated access."
        },
        "backup-recovery-procedures": {
          "description": "Addresses SOX 404 ITGC (Backup and Recovery), NIST CSF 2.0 PR.DS-11 (Data backups maintained, tested, and documented), and SOC2 TSC A1.3 (Recovery plan procedures established and tested). Essential for business continuity and data integrity."
        },
        "secure-configuration-management": {
          "description": "Addresses PCI-DSS 4.0 Req 2.X (Apply Secure Configurations to All System Components) and NIST CSF 2.0 PR.PS-01 (Configuration management practices established). Critical for reducing attack surface and maintaining system integrity."
        },
        "secrets-management-service": {
          "description": "Addresses CCC-CIS-06 (Secrets management) and NIST CSF 2.0 PR.AA-01 (Identities and credentials managed). Strengthens the protection of sensitive credentials beyond basic authentication."
        }
      },
      "data-classification": "RESTRICTED"
    },
    {
      "unique-id": "fraud-detection",
      "node-type": "service",
      "name": "Fraud Detection",
      "description": "ML-based fraud scoring engine analyzing transaction patterns and risk indicators",
      "controls": {
        "model-monitoring": {
          "description": "Monitor ML model performance and retrain quarterly on new fraud patterns",
          "requirements": [
            {
              "requirement-url": "https://www.iso.org/standard/54534.html"
            }
          ]
        },
        "multi-factor-authentication": {
          "description": "Addresses PCI-DSS 4.0 Req 8.4.2 (MFA for all access into CDE), NIST CSF 2.0 PR.AA-03 (users, services, hardware authenticated), and SOC2 TSC CC6.5 (Logical access restricted using multi-factor authentication). Critically missing MFA for administrative access fails these controls."
        },
        "role-based-access-control": {
          "description": "Addresses PCI-DSS 4.0 Req 7.2 (Access to system components restricted per least privilege), NIST CSF 2.0 PR.AA-05 (Access permissions, entitlements, authorizations managed), and SOC2 TSC CC6.1 (Logical access security software, infrastructure, architectures) and CC6.3 (Role-based access and least privilege). Lack of granular access control fails these requirements."
        },
        "data-encryption-at-rest": {
          "description": "Addresses 'Top Risk Finding: Limited data protection controls'. Essential for protecting confidential data in compliance with general data protection principles."
        },
        "data-encryption-in-transit": {
          "description": "Addresses 'Top Risk Finding: Limited data protection controls'. Essential for protecting confidential data in transit, complementing existing HTTPS/TLS where applicable."
        },
        "access-logging-detailed": {
          "description": "Addresses 'Top Risk Finding: Limited data protection controls and insufficient logging'. Essential for audit trails and incident investigation for confidential data."
        },
        "data-retention-policy-fraud-detection": {
          "description": "Addresses 'Top Risk Finding: Limited data protection controls'. Essential for minimizing data exposure and complying with data privacy regulations."
        }
      },
      "data-classification": "CONFIDENTIAL"
    },
    {
      "unique-id": "transaction-database",
      "node-type": "database",
      "name": "Transaction Database",
      "description": "Payment transaction records and authorization history",
      "controls": {
        "data-encryption": {
          "description": "Transparent data encryption for all payment transaction records",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "audit-logging": {
          "description": "Database audit trail for all access to payment records",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "data-retention": {
          "description": "Retain transaction records for 3 years, securely delete afterward",
          "requirements": [
            {
              "requirement-url": "https://www.visa.com/splisting/searchGrsp.do?companyNameCriteria=data%20retention"
            }
          ]
        },
        "multi-factor-authentication": {
          "description": "Addresses PCI-DSS 4.0 Req 8.4.2 (MFA for all access into CDE), NIST CSF 2.0 PR.AA-03 (users, services, hardware authenticated), and SOC2 TSC CC6.5 (Logical access restricted using multi-factor authentication). Critically missing MFA for administrative access fails these controls."
        },
        "role-based-access-control": {
          "description": "Addresses PCI-DSS 4.0 Req 7.2 (Access to system components restricted per least privilege), NIST CSF 2.0 PR.AA-05 (Access permissions, entitlements, authorizations managed), and SOC2 TSC CC6.1 (Logical access security software, infrastructure, architectures) and CC6.3 (Role-based access and least privilege). Lack of granular access control fails these requirements."
        },
        "privileged-access-management": {
          "description": "Addresses SOX 404 ITGC Access Controls (Privileged Access Management) for critical financial systems. Enhances security by controlling and auditing elevated access."
        },
        "extended-data-retention-policy": {
          "description": "The existing 'data-retention' control's 3-year period for transaction records is insufficient for SOX (SEC Rule 17a-4, typically 7 years) and the absence of specific audit log retention fails PCI-DSS 4.0 Req 10.5.1 (Audit log history retained for 12 months). This control ensures compliance with stricter regulatory requirements."
        },
        "backup-recovery-procedures": {
          "description": "Addresses SOX 404 ITGC (Backup and Recovery), NIST CSF 2.0 PR.DS-11 (Data backups maintained, tested, and documented), and SOC2 TSC A1.3 (Recovery plan procedures established and tested). Essential for business continuity and data integrity."
        },
        "secure-configuration-management": {
          "description": "Addresses PCI-DSS 4.0 Req 2.X (Apply Secure Configurations to All System Components) and NIST CSF 2.0 PR.PS-01 (Configuration management practices established). Critical for reducing attack surface and maintaining system integrity."
        }
      },
      "data-classification": "CONFIDENTIAL"
    },
    {
      "unique-id": "card-network",
      "node-type": "system",
      "name": "Card Network",
      "description": "External card network (Visa/Mastercard) for authorization and settlement",
      "data-classification": "RESTRICTED",
      "controls": {
        "third-party-risk-management": {
          "description": "Addresses NIST CSF 2.0 GV.SC-02 (Cybersecurity supply chain risk management established). Mitigates risks from external dependencies."
        }
      }
    },
    {
      "unique-id": "cardholder-data",
      "node-type": "data-asset",
      "name": "Cardholder Data",
      "description": "PCI-DSS scoped cardholder data including PAN, CVV, and expiration date",
      "controls": {
        "data-minimization": {
          "description": "Collect only minimum required cardholder data, never store CVV",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "data-residency-documentation": {
          "description": "Addresses CCC-DPP-06 (Data residency and sovereignty controls). Essential for compliance with data protection regulations and demonstrating control over data location."
        }
      },
      "data-classification": "RESTRICTED"
    }
  ],
  "relationships": [
    {
      "unique-id": "customer-to-checkout",
      "description": "Customer enters payment information on checkout page",
      "relationship-type": "interacts",
      "interacts": {
        "actor": "customer",
        "nodes": [
          "checkout-page"
        ]
      }
    },
    {
      "unique-id": "checkout-to-payment-api",
      "description": "Checkout page submits encrypted payment data to payment API",
      "protocol": "HTTPS",
      "controls": {
        "tls-enforcement": {
          "description": "Enforce TLS 1.2 minimum with strong cipher suites",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        }
      },
      "relationship-type": "connects",
      "connects": {
        "source": {
          "node": "checkout-page"
        },
        "destination": {
          "node": "payment-api"
        }
      }
    },
    {
      "unique-id": "payment-api-to-tokenization",
      "description": "Payment API requests card tokenization",
      "protocol": "mTLS",
      "relationship-type": "connects",
      "connects": {
        "source": {
          "node": "payment-api"
        },
        "destination": {
          "node": "tokenization-service"
        }
      }
    },
    {
      "unique-id": "payment-api-to-fraud",
      "description": "Payment API checks transaction for fraud indicators",
      "protocol": "HTTPS",
      "relationship-type": "connects",
      "connects": {
        "source": {
          "node": "payment-api"
        },
        "destination": {
          "node": "fraud-detection"
        }
      }
    },
    {
      "unique-id": "payment-api-to-db",
      "description": "Payment API persists transaction records",
      "protocol": "TLS",
      "relationship-type": "connects",
      "connects": {
        "source": {
          "node": "payment-api"
        },
        "destination": {
          "node": "transaction-database"
        }
      }
    },
    {
      "unique-id": "tokenization-to-card-network",
      "description": "Tokenization service forwards authorization request to card network",
      "protocol": "mTLS",
      "relationship-type": "connects",
      "connects": {
        "source": {
          "node": "tokenization-service"
        },
        "destination": {
          "node": "card-network"
        }
      }
    }
  ],
  "flows": [
    {
      "unique-id": "payment-processing-flow",
      "name": "Payment Processing Flow",
      "description": "Complete payment flow from customer card entry through authorization",
      "transitions": [
        {
          "relationship-unique-id": "customer-to-checkout",
          "sequence-number": 1,
          "description": "Customer enters card details on checkout page"
        },
        {
          "relationship-unique-id": "checkout-to-payment-api",
          "sequence-number": 2,
          "description": "Checkout submits encrypted payment to API"
        },
        {
          "relationship-unique-id": "payment-api-to-fraud",
          "sequence-number": 3,
          "description": "Payment API checks fraud score"
        },
        {
          "relationship-unique-id": "payment-api-to-tokenization",
          "sequence-number": 4,
          "description": "Payment API requests tokenization"
        },
        {
          "relationship-unique-id": "tokenization-to-card-network",
          "sequence-number": 5,
          "description": "Tokenization service authorizes with card network"
        },
        {
          "relationship-unique-id": "payment-api-to-db",
          "sequence-number": 6,
          "description": "Payment API records transaction"
        }
      ]
    }
  ],
  "controls": {
    "change-management-process": {
      "description": "Addresses SOX 404 ITGC (Change Management) and NIST CSF 2.0 PR.PS-01 (Configuration management practices established). Lack of formal change control poses a critical risk to financial reporting integrity."
    },
    "incident-response-plan": {
      "description": "Addresses SOX 404 ITGC (Incident Management), PCI-DSS 4.0 Req 12.10.1 (Incident response plan established and maintained), NIST CSF 2.0 RS.MA-01 (Incident response plan executed), and SOC2 TSC CC7.4 (Security incidents identified and reported). A critical control for maintaining security posture and regulatory compliance."
    },
    "network-segmentation-cde": {
      "description": "Addresses PCI-DSS 4.0 Req 1.2.1 (Define and understand inbound/outbound traffic rules), NIST CSF 2.0 PR.IR-01 (Networks and environments are protected), and SOC2 TSC CC6.6 (Logical access security measures protect against external threats). Essential for protecting cardholder data by limiting the scope of CDE."
    },
    "centralized-log-management-retention": {
      "description": "Addresses PCI-DSS 4.0 Req 10.5.1 (Audit log history retained for 12 months). Essential for forensic analysis, incident response, and regulatory compliance."
    },
    "vulnerability-scanning": {
      "description": "Addresses PCI-DSS 4.0 Req 11.3.1 (Internal vulnerability scans performed quarterly) and NIST CSF 2.0 ID.RA-01 (Vulnerabilities identified, validated, recorded). Critical for proactive identification and remediation of security weaknesses."
    },
    "penetration-testing-annual": {
      "description": "Addresses PCI-DSS 4.0 Req 11.4.1 (External penetration testing performed annually) and NIST CSF 2.0 ID.RA-01 (Vulnerabilities identified, validated, recorded). Essential for robust security validation."
    },
    "intrusion-detection-prevention": {
      "description": "Addresses PCI-DSS 4.0 Req 11.5.1 (Intrusion-detection techniques detect intrusions), NIST CSF 2.0 DE.CM-01 (Networks monitored for anomalous behavior), and SOC2 TSC CC7.1 (Infrastructure components monitored to detect anomalies). Crucial for real-time threat detection and response."
    },
    "organizational-security-policy": {
      "description": "Addresses NIST CSF 2.0 GV.PO-01 (Cybersecurity policy established and communicated). A foundational control for a robust cybersecurity program."
    },
    "risk-management-process": {
      "description": "Addresses NIST CSF 2.0 GV.RM-01 (Risk management objectives established and communicated). Essential for informed decision-making regarding cybersecurity investments and priorities."
    },
    "mission-aligned-cybersecurity-strategy": {
      "description": "Addresses NIST CSF 2.0 GV.OC-01 (Organizational mission understood and informs cybersecurity). Crucial for establishing context and ensuring cybersecurity efforts support business goals."
    },
    "malware-protection": {
      "description": "Addresses NIST CSF 2.0 DE.CM-04 (Malicious code detected) and SOC2 TSC CC7.2 (Malicious software detected and addressed). Essential for protecting systems from malware infections."
    },
    "disaster-recovery-plan": {
      "description": "Addresses NIST CSF 2.0 RC.RP-01 (Recovery plan executed). Crucial for ensuring business continuity."
    },
    "secure-sdlc": {
      "description": "Addresses PCI-DSS 4.0 Req 6.2.4 (Software engineering techniques prevent vulnerabilities) and related CCC recommendations. Essential for proactively identifying and remediating vulnerabilities in custom code."
    }
  }
}